#!/usr/bin/env php
<?php
if (!is_callable('exec')) {
    echo "âŒ El sistema no permite ejecuciÃ³n de comandos.";
    exit(1);
}

$path = getenv('PATH');
$bin = realpath(__DIR__ . '/yervix');

if (!strpos($path, dirname($bin))) {
    echo "âš ï¸ El comando `yervix` no estÃ¡ en tu PATH.";
    echo "\nPuedes agregarlo ejecutando:\n";
    echo "export PATH=\"".dirname($bin).":\$PATH\"\n";
    // Opcional: ofrecer agregarlo automÃ¡ticamente si es seguro
}

$command = $argv[1] ?? null;
$arg = $argv[2] ?? null;

switch ($command) {
  case 'new':
    if (!$arg) {
      echo "âŒ Debes indicar el nombre del proyecto.\n";
      echo "â„¹ï¸ Uso: php yervix new nombre-del-proyecto\n";
      exit;
    }

    require __DIR__ . '/cli/installer.php';
    yervix_install_project($arg);
    break;

  case 'serve':
    echo "ðŸš€ Iniciando servidor Yervix...\n";
    passthru("php -S localhost:8000 index.php");
    break;

  default:
    echo "ðŸ§­ Comandos disponibles:\n";
    echo "   new     â†’ Instala el framework Yervix\n";
    echo "   serve   â†’ Levanta el servidor local\n";
    break;
}