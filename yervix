#!/usr/bin/env php
<?php
if (!is_callable('exec')) {
    echo "❌ El sistema no permite ejecución de comandos.";
    exit(1);
}

$path = getenv('PATH');
$bin = realpath(__DIR__ . '/yervix');

if (!strpos($path, dirname($bin))) {
    echo "⚠️ El comando `yervix` no está en tu PATH.";
    echo "\nPuedes agregarlo ejecutando:\n";
    echo "export PATH=\"".dirname($bin).":\$PATH\"\n";
    // Opcional: ofrecer agregarlo automáticamente si es seguro
}

$command = $argv[1] ?? null;
$arg = $argv[2] ?? null;

switch ($command) {
  case 'new':
    if (!$arg) {
      echo "❌ Debes indicar el nombre del proyecto.\n";
      echo "ℹ️ Uso: php yervix new nombre-del-proyecto\n";
      exit;
    }

    require __DIR__ . '/cli/installer.php';
    yervix_install_project($arg);
    break;

  case 'serve':
    echo "🚀 Iniciando servidor Yervix...\n";
    passthru("php -S localhost:8000 index.php");
    break;

  default:
    echo "🧭 Comandos disponibles:\n";
    echo "   new     → Instala el framework Yervix\n";
    echo "   serve   → Levanta el servidor local\n";
    break;
}